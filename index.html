<!DOCTYPE html>
<html>
  <head>
    <title>Target Demo â€“ at.js 2.x</title>

    <script>
      // Let's fake a data layer and use a query param to simulate being logged in!
      const urlParams = new URLSearchParams(window.location.search);
      let digitalData = {
        entity: {
          id: "12345",
          name: "Your New Favorite Hat",
          category: "cdDemo",
        },
        page: {
          name: "Target Demo Page",
        },
        targetParams: {
          weather: {
            temperature: "normal",
            condition: "pleasant",
          },
          user: {
            loggedIn: "false",
          },
        },
      };
      // Various extra params for when logged in
      if (urlParams.has("demo")) {
        switch (urlParams.get("demo")) {
          case "logged-in-cold":
            digitalData.targetParams = {
              user: {
                id: "123456",
                firstName: "Chris",
                loggedIn: "true",
              },
              profile: {
                gender: "male",
                favoriteColor: "green",
              },
              weather: {
                temperature: "cold",
                condition: "windy",
              },
            };
            break;
          case "logged-in-hot":
            digitalData.targetParams = {
              user: {
                id: "123456",
                firstName: "Chris",
                loggedIn: "true",
              },
              profile: {
                gender: "male",
                favoriteColor: "blue",
              },
              weather: {
                temperature: "hot",
                condition: "sunny",
              },
            };
            break;
        }
      }
      //simulated data provider
      var weatherDataProvider = {
        name: "weatherData",
        version: "1.0.0",
        provider: function (callback) {
          // simulating network request
          setTimeout(function () {
            callback(null, {
              "weather.temperature":
                digitalData.targetParams.weather.temperature,
              "weather.condition": digitalData.targetParams.weather.condition,
            });
          }, 500);
        },
      };

      // Target Global Settings - With a Data Provider!
      window.targetGlobalSettings = {
        cookieDomain: "imalreadyafiddle.github.io",
        dataProviders: [weatherDataProvider],
        secureOnly: true,
      };

      //   // Target Prehiding
      //   (function (win, doc, style, timeout) {
      //     var STYLE_ID = "at-body-style";

      //     function getParent() {
      //       return doc.getElementsByTagName("head")[0];
      //     }

      //     function addStyle(parent, id, def) {
      //       if (!parent) {
      //         return;
      //       }

      //       var style = doc.createElement("style");
      //       style.id = id;
      //       style.innerHTML = def;
      //       parent.appendChild(style);
      //     }

      //     function removeStyle(parent, id) {
      //       if (!parent) {
      //         return;
      //       }

      //       var style = doc.getElementById(id);

      //       if (!style) {
      //         return;
      //       }

      //       parent.removeChild(style);
      //     }

      //     addStyle(getParent(), STYLE_ID, style);
      //     setTimeout(function () {
      //       removeStyle(getParent(), STYLE_ID);
      //     }, timeout);
      //   })(window, document, "body {opacity: 0 !important}", 750);
      //
    </script>

    <!--Adobe Data Collection Container-->
    <script>
      console.log(digitalData);
    </script>
    <script
      src="https://assets.adobedtm.com/409c9b2973cc/35b29fd8c6f5/launch-d33653e19672.min.js"
      async
    ></script>

    <style>
      .button {
        height: 3rem;
        margin: 5px;
        background-color: #ccc;
        border: none;
        cursor: pointer;
        border-radius: 15px;
        font-size: 2rem;
      }
      .button:hover {
        background-color: #bbb;
      }
      .button:active {
        background-color: #444;
      }
      body {
        background-color: #000;
        color: #fff;
      }
      .grid {
        display: grid;
        grid-gap: 10px;
        padding: 10px;
      }
      .three-col {
        grid-template-columns: repeat(3, 1fr);
      }
      h1,
      .rank-order-holder,
      .catfinity-info,
      p {
        text-align: center;
        font-family: Arial, Helvetica, sans-serif;
      }
      .catfinity-info,
      .rank-order {
        list-style-position: inside;
      }
      .rank-order-list {
        display: inline-block;
        text-align: left;
        margin-bottom: 5px;
      }
      .rank-order-holder {
        text-align: center;
      }
      li:first-of-type {
        margin-top: 15px;
      }
      li {
        margin-bottom: 5px;
        text-align: left;
      }
      ol {
        padding-right: 40px;
      }
    </style>
  </head>
  <body>
    <div
      class="product-detail card"
      style="
        border: 2px solid #ccc;
        border-radius: 15px;
        padding: 20px;
        max-width: 450px;
        margin: 0 auto;
      "
    >
      <h1>Your New Favorite Hat</h1>
      <div class="hat-container">
        <svg
          version="1.1"
          id="Layer_1"
          xmlns="http://www.w3.org/2000/svg"
          xmlns:xlink="http://www.w3.org/1999/xlink"
          viewBox="0 0 512 512"
          xml:space="preserve"
          width="300"
          height="250"
        >
          <g>
            <path
              style="fill: #2a2a8a"
              d="M71.901,371.82l34.648-180.17c3.119-16.219,17.312-27.944,33.828-27.944h247.203
            c7.624,0,14.752,2.497,20.525,6.781c6.751,5.01,11.648,12.463,13.316,21.221l26.684,140.088"
            />
            <polygon style="fill: #2a2a8a" points />
          </g>
          <g>
            <polygon
              style="fill: #4a4aab"
              points="288.017,403.837 7.866,403.837 7.866,379.824 288.017,347.806 	"
            />
            <path
              style="fill: #4a4aab"
              d="M71.901,371.82l34.648-180.17c3.119-16.219,17.312-27.944,33.828-27.944h147.64v184.1L71.901,371.82
            z"
            />
          </g>
          <polygon
            style="fill: #1c6cfa"
            points="87.909,299.781 71.901,371.82 448.104,331.798 440.1,299.781 "
          />
          <polygon
            style="fill: #49a0fb"
            points="87.909,299.781 71.901,371.82 280.013,347.806 280.013,299.781 "
          />
          <g>
            <rect
              x="111.925"
              y="315.933"
              style="fill: #1d1d1b"
              width="24.013"
              height="15.732"
            />
            <rect
              x="151.946"
              y="315.933"
              style="fill: #1d1d1b"
              width="24.013"
              height="15.732"
            />
            <rect
              x="191.968"
              y="315.933"
              style="fill: #1d1d1b"
              width="24.013"
              height="15.732"
            />
            <rect
              x="231.989"
              y="315.933"
              style="fill: #1d1d1b"
              width="24.013"
              height="15.732"
            />
            <rect
              x="272.01"
              y="315.933"
              style="fill: #1d1d1b"
              width="24.013"
              height="15.732"
            />
            <rect
              x="312.031"
              y="315.933"
              style="fill: #1d1d1b"
              width="24.013"
              height="15.732"
            />
          </g>
          <g>
            <path
              style="fill: #ffffff"
              d="M336.612,126.432l-84.899,84.899c-12.503,12.503-12.503,32.776,0,45.28
            c12.503,12.504,32.775,12.504,45.28,0l130.178-130.178C402.164,101.425,361.619,101.425,336.612,126.432"
            />
          </g>
          <polyline
            style="fill: #1c6cfa"
            points="361.68,191.924 322.061,186.264 316.4,146.644 282.441,180.603 288.101,220.223 
            327.72,225.883 361.68,191.924 "
          />
          <polyline
            style="fill: #49a0fb"
            points="395.64,157.964 356.02,152.304 350.36,112.685 316.4,146.644 322.061,186.264 
            361.68,191.924 395.64,157.964 "
          />
          <path
            style="fill: #1d1d1b"
            d="M454.159,321.999l-25.011-131.309c-1.993-10.46-7.802-19.718-16.356-26.066
            c-2.426-1.801-5.004-3.314-7.696-4.542l33.198-33.198l-5.562-5.563c-28.033-28.033-73.647-28.033-101.683,0l-35.024,35.025v-0.052
            H140.377c-20.253,0-37.728,14.435-41.552,34.324l-33.632,174.88L0,372.789v38.914h512V315.53L454.159,321.999z M413.694,193.635
            l18.807,98.734H227.534l24.726-24.726c6.49,4.337,14.112,6.665,22.093,6.665c10.653,0,20.669-4.149,28.202-11.682l90.098-90.098
            c3.875,0.747,7.534,2.332,10.765,4.73C408.792,181.246,412.442,187.063,413.694,193.635z M415.66,127.272l-22.8,22.8l-29.886-4.269
            l-3.585-25.097C377.637,112.752,399.28,114.937,415.66,127.272z M342.174,132.447c0.859-0.859,1.746-1.672,2.646-2.464l4.246,29.725
            l29.886,4.27l-20.055,20.055l-29.886-4.27l-4.27-29.886L342.174,132.447z M310.839,163.783l4.27,29.885l29.885,4.271l-20.055,20.055
            l-29.886-4.269l-4.27-29.886L310.839,163.783z M311.034,231.898l-19.604,19.604c-4.561,4.562-10.626,7.074-17.077,7.074
            c-3.729,0-7.318-0.864-10.574-2.454l12.903-12.903l-11.123-11.124l-12.904,12.904c-1.59-3.255-2.454-6.844-2.454-10.573
            c0-6.451,2.513-12.517,7.074-17.077l19.603-19.604l4.27,29.885L311.034,231.898z M114.273,193.588
            c2.402-12.494,13.38-21.563,26.104-21.563h139.97l-34.195,34.195c-7.533,7.533-11.682,17.548-11.682,28.203
            c0,7.981,2.329,15.604,6.665,22.093l-35.85,35.85H95.277L114.273,193.588z M87.721,331.659h8.193v-15.732h-5.167l1.506-7.829
            h343.245l1.491,7.829h-4.894v8.539l-16.008,1.79v-10.329h-24.013v13.014l-16.008,1.79v-14.804h-24.013v15.732h15.724L81.565,363.667
            L87.721,331.659z M496.268,395.971H15.732v-9.112l480.537-53.739V395.971z"
          />
        </svg>
      </div>
      <p class="price">$39.99</p>
    </div>

    <style>
      .product-detail {
        text-align: center;
        margin: 20px 0;
        font-family: Arial, Helvetica, sans-serif;
      }
      .hat-container {
        margin: 10px 0;
      }
      .color-options .button {
        margin: 5px;
      }
      .price {
        font-size: 1.5rem;
        font-family: Arial, Helvetica, sans-serif;
      }
    </style>

    <!-- For Displaying Weather from digitalData as simulated current weeather -->
    <h1>WHAT'S THE WEATHER LIKE?</h1>
    <p>
      The weather is currently
      <span id="weatherCondition">pleasant</span> and
      <span id="weatherTemperature">normal</span>.
    </p>

    <!-- For Sending Category Affinity Information-->
    <h1>GOES GREAT WITH:</h1>
    <p>
      Click on a category to see more of what you want! We'll remember your
      preferences.
    </p>

    <div class="grid three-col">
      <button
        class="button"
        data-button-id="0"
        onclick="handleCategoryClick('tops')"
      >
        TOPS
      </button>
      <button
        class="button"
        data-button-id="1"
        onclick="handleCategoryClick('bottoms')"
      >
        BOTTOMS
      </button>
      <button
        class="button"
        data-button-id="2"
        onclick="handleCategoryClick('accessories')"
      >
        ACCESSORIES
      </button>
    </div>
    <div class="rank-order-holder"></div>
    <hr />

    <!-- For Changing a Color Preference -->
    <h1 id="colorPreferenceHeading">WHAT'S YOUR FAVORITE COLOR?!</h1>
    <!-- Let's keep it simple, it should be a slider with options for "green" & "blue" -->
    <div class="color-toggle">
      <input type="checkbox" id="colorToggle" class="toggle-checkbox" />
      <label for="colorToggle" class="toggle-label">
        <span class="toggle-inner"></span>
        <span class="toggle-switch"></span>
      </label>
    </div>

    <style>
      .color-toggle {
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 20px 0;
      }

      .toggle-checkbox {
        display: none;
      }

      .toggle-label {
        position: relative;
        width: 100px; /* Increased width */
        height: 30px;
        background: linear-gradient(
          90deg,
          #4caf50,
          #2196f3
        ); /* Static gradient */
        border-radius: 30px;
        cursor: pointer;
        transition: background 0.3s ease-in-out;
      }

      .toggle-inner {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 100%;
        height: 100%;
        border-radius: 30px;
        transform: translate(-50%, -50%);
        background: transparent; /* No background needed */
      }

      .toggle-switch {
        position: absolute;
        top: 3px;
        left: 3px;
        width: 24px;
        height: 24px;
        background: #fff;
        border-radius: 50%;
        transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
      }

      .toggle-checkbox:checked + .toggle-label .toggle-switch {
        transform: translateX(70px); /* Adjusted for new width */
      }

      #colorPreferenceHeading {
        transition: color 0.3s ease-in-out;
      }
    </style>

    <script>
      function setColorOnLoad() {
        const colorToggle = document.getElementById("colorToggle");
        const h1 = document.querySelector("h1:nth-of-type(3)");
        const toggleLabel = document.querySelector(".toggle-label");
        const color = colorToggle.checked ? "#2196f3" : "#4caf50";

        h1.style.color = color;
        toggleLabel.style.backgroundColor = color;

        // Call the arbitrary function with the color
        setFavoriteColor(color);
      }

      document
        .getElementById("colorToggle")
        .addEventListener("change", function () {
          setColorOnLoad();
        });

      // Set color on page load
      window.onload = setColorOnLoad;
    </script>

    <script>
      function handleCategoryClick(category) {
        // Send Category Affinity here; new Recs will be shown if there's a new primary category
        console.log(category + " button was clicked.");
        adobe.target.getOffer({
          mbox: "category-affinity-mbox",
          params: {
            "user.categoryId": category,
          },
          success: function (offer) {
            adobe.target.applyOffer({
              mbox: "category-affinity-mbox",
              offer: offer,
            });
          },
          error: function (status, error) {
            console.log("Error", status, error);
          },
        });
      }

      function setFavoriteColor(color) {
        console.log("The toggle is set to color:", color);
        // Add your custom logic here
      }

      function changeWeatherSpans(weather) {
        const weatherCondition = document.getElementById("weatherCondition");
        const weatherTemperature =
          document.getElementById("weatherTemperature");

        weatherCondition.innerText = weather.condition;
        weatherTemperature.innerText = weather.temperature;
      }
      changeWeatherSpans(digitalData.targetParams.weather);
    </script>
  </body>
</html>
